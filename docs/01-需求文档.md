# 营销文案生成 AI Agent - 需求文档

## 1. 项目概述

### 1.1 项目名称

营销文案生成 AI Agent

### 1.2 项目目标

构建基于 LangGraph 的 AI Agent，具备 Skills 与 MCP 能力，根据用户输入自动生成高质量营销文案（文字与图片）。支持上下文增强、图片理解与生成、多平台参考检索等能力。

### 1.3 目标用户

- 营销人员：快速生成各平台营销文案
- 内容创作者：从参考素材生成或增强营销内容
- 电商/品牌方：批量生成产品/活动营销文案

---

## 2. 功能需求

### 2.1 核心功能

#### 2.1.1 输入

| 输入项 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| 营销需求 | 文本 | 是 | 用户对文案目标、风格、受众等的描述 |
| 营销描述 | 文本 | 否 | 产品/活动详细描述，可配合图片补充 |
| 参考图片 | 图片 | 否 | 用户提供的参考图，用于理解或增强 |
| 平台偏好 | 枚举 | 否 | 目标平台（如小红书、微博、抖音） |
| 风格偏好 | 文本 | 否 | 文案风格（如正式、活泼、专业） |

#### 2.1.2 输出

| 输出项 | 类型 | 说明 |
|--------|------|------|
| 营销文案 | 文本 | 主文案内容，可含多段/多版本 |
| 图片提示词 | 文本 | 用于图片生成的提示词 |
| 生成图片 | 图片列表 | 根据描述或输入图片生成的多张图片 |
| 元数据 | 对象 | 生成过程、参考来源、置信度等 |

#### 2.1.3 合规安全校验（必选）

**输入侧校验**：在进入 Agent 主流程前，对以下内容进行校验：

| 校验对象 | 校验项 | 不合规处理 |
|----------|--------|------------|
| 营销需求 | 违法内容、违禁词、诱导、虚假宣传倾向 | 拒绝请求，返回错误码及原因 |
| 营销描述 | 同上 | 同上 |
| 参考图片 | 违规图片内容（色情、暴力、侵权等） | 拒绝请求，返回错误码及原因 |

**输出侧校验**：在返回用户前，对生成内容进行校验：

| 校验对象 | 校验项 | 不合规处理 |
|----------|--------|------------|
| 营销文案 | 广告法违规、平台规范违规、违禁词、虚假宣传 | 拦截输出，重试生成或返回安全提示 |
| 图片提示词 | 违规提示词、不当描述 | 拦截，不进入图片生成 |
| 生成图片 | 违规图片内容 | 过滤，仅返回文案 |

### 2.2 智能处理能力

#### 2.2.1 上下文增强

- **触发**：输入描述不清晰、不专业或信息不足
- **逻辑**：调用 LLM 对输入进行补全、润色、结构化
- **输出**：增强后的清晰、专业描述，供后续节点使用

#### 2.2.2 上下文增强

- **输入**：用户需求（文本）+ 参考图片（可选，可能多张）
- **逻辑**：多模态 LLM 将模糊需求转为清晰、结构化增强提示词
- **输出**：enhanced_context

#### 2.2.3 是否生成图像（动态决策）

- **有输入图**：通常生成配图，除非用户明确/暗示仅要纯文本
- **无输入图**：由 LLM 根据需求文本判断是否需要生成图像

#### 2.2.4 图像描述提示词

- **输入**：用户需求（文本）+ 参考图片（可选）
- **逻辑**：生成适合图像模型的描述提示词
- **输出**：1–3 条图像提示词

#### 2.2.5 图片生成

- **输入**：图像描述提示词 + 输入图片（可选，用于风格参考）
- **逻辑**：多模态 LLM 生成推广文案配图
- **输出**：生成图片列表

### 2.3 能力集成

#### 2.3.1 Skills

- 文案撰写 Skill：专业营销文案规则与模板
- 图片提示词 Skill：图片提示词生成最佳实践
- 平台规范 Skill：各平台（小红书、微博等）文案规范与限制

#### 2.3.2 多模型调用（均本地部署）

- **上下文增强 LLM**：本地部署，偏速度、成本
- **文案生成 LLM**：本地部署，偏质量
- **图片理解 LLM**：本地多模态模型（如 LLaVA、Qwen-VL）
- **图片生成**：由本地多模态 LLM（如 vLLM 部署的模型）统一处理
- **安全校验模型**：本地部署，用于输入/输出内容合规

> **约束**：不调用任何外部 API，所有模型部署于本机或内网。

#### 2.3.3 多模态能力

LLM 支持两种模式：文本+图像（可选）→ 文本；文本+图像（可选）→ 图像。

| 环节 | 模态 | 说明 |
|------|------|------|
| 上下文增强 | 文本+图(可选)→文本 | 需求→增强提示词 |
| 是否生成图像 | 文本→文本 | 无图时 LLM 判断 |
| 文案撰写 | 文本→文本 | 增强提示词→推广文案 |
| 图像描述提示词 | 文本+图(可选)→文本 | 需求→图像提示词 |
| 图片生成 | 文本+图(可选)→图像 | 提示词+图→配图 |

---

## 3. 非功能需求

### 3.1 接口

- **协议**：HTTP/REST
- **框架**：FastAPI
- **请求方式**：POST，支持 JSON 与 multipart（含图片上传）

### 3.2 性能

- **并发**：支持并行请求处理
- **响应时间**：单次文案生成目标 < 30s（不含图片生成）
- **吞吐**：随部署规模水平扩展

### 3.3 可靠性

- LLM 调用失败时支持重试（指数退避）
- MCP 服务不可用时降级策略
- 关键步骤超时控制

### 3.4 可观测性

- 结构化日志（structlog）
- 请求追踪（可选 LangSmith）
- 关键指标：延迟、成功率、Token 消耗

### 3.5 安全

- 敏感配置通过环境变量
- 图片上传大小与格式限制
- 请求限流（可选）
- **输入/输出合规校验**：规则（违禁词）+ LLM 双重校验；不合规内容拒绝或拦截

---

## 4. 约束与假设

### 4.1 技术约束

- Python 3.12+
- LangGraph 作为 Agent 编排框架
- **所有模型本地部署**：LLM、多模态、图片生成、安全校验均使用本地模型；不调用外部 API
- 图片生成由本地多模态 LLM 处理；不单独集成图片生成模型

### 4.2 业务假设

- 小红书等平台 MCP Server 需自行部署或对接第三方（MCP 为本地/内网服务）
- 本地部署使用 vLLM 等部署主 LLM 及其他 LLM（增强、多模态）；Agent 直接调用
- Skills 由项目内提供或作为 Cursor Skills

### 4.3 可扩展性

- **模块化设计**：Skills、阶段上下文、MCP Server 均采用注册表/配置驱动，便于扩展
- 支持新增 MCP Server：通过 `mcp_servers.yaml` 配置
- 支持新增 Skill：在 `skills/builtin/` 或 `SKILLS_DIRS`
- 支持新增目标平台：通过 platform_rules Skill 及阶段上下文配置

---

## 5. 术语表

| 术语 | 说明 |
|------|------|
| LangGraph | 基于图的 Agent 编排框架 |
| MCP | Model Context Protocol（模型上下文协议） |
| Skill | 供 Agent 使用的领域知识/工作流封装 |
| 上下文增强 | 对模糊输入进行补全、润色、结构化 |
| 图片提示词 | 供图片生成模型使用的文本提示 |
| 安全校验 | 输入/输出合规、违禁词、广告法、平台规范检查 |
